# gohub å¼€æºé¡¹ç›®è®¡åˆ’ï¼ˆæ›´æ–°ç‰ˆï¼‰

> **ç‰ˆæœ¬ï¼š2025â€‘05â€‘15**
> *æ­¤æ¬¡æ›´æ–°ï¼šæ”¹ç”¨ ****etcd**** ä½œä¸ºå”¯ä¸€çš„é›†ç¾¤æ¶ˆæ¯æ€»çº¿ï¼Œå®ç°å•æœº/åˆ†å¸ƒå¼åŒæ¨¡å¼ã€‚*

---

## ç›®å½•

1. [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
2. [ä¸€æœŸç›®æ ‡ï¼ˆ2025â€‘Q2ï¼‰](#ä¸€æœŸç›®æ ‡2025q2)

    1. [æ ¸å¿ƒèƒ½åŠ›](#æ ¸å¿ƒèƒ½åŠ›)
    2. [æŠ€æœ¯æ ˆä¸æ¶æ„](#æŠ€æœ¯æ ˆä¸æ¶æ„)
    3. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
    4. [æµ‹è¯•ä¸è´¨é‡ä¿éšœ](#æµ‹è¯•ä¸è´¨é‡ä¿éšœ)
    5. [å®‰å…¨ & æ€§èƒ½](#å®‰å…¨--æ€§èƒ½)
3. [äºŒæœŸç›®æ ‡ï¼ˆ2025â€‘Q3ï¼‰](#äºŒæœŸç›®æ ‡2025q3)
4. [é•¿æœŸæ¼”è¿›æ–¹å‘](#é•¿æœŸæ¼”è¿›æ–¹å‘)
5. [è®¸å¯è¯](#è®¸å¯è¯)

---

## é¡¹ç›®ç®€ä»‹

**gohub** æ˜¯ä¸€æ¬¾ç”¨ **Golang** ç¼–å†™ã€å¼€æºã€å¯ç”Ÿäº§è¿è¡Œçš„ **WebSocket Hub**ã€‚é¢å‘ Golang æ–°æ‰‹æä¾›ã€Œä¸€é”®å¯è·‘ã€æ˜“äºé˜…è¯»ã€çš„ä»£ç ï¼ŒåŒæ—¶æ»¡è¶³ä¼ä¸šçº§éƒ¨ç½²éœ€è¦ï¼Œå¯åœ¨å•æœºæˆ–å¤šå®ä¾‹é›†ç¾¤æ¨¡å¼ä¸‹æ”¯æ’‘ **ä¸‡çº§é•¿è¿æ¥**ã€‚é¡¹ç›®é‡‡ç”¨ **MIT** è®¸å¯è¯ï¼Œæ‰€æœ‰äººå¯è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€å•†ç”¨ã€‚

---

## ä¸€æœŸç›®æ ‡ï¼ˆ2025â€‘Q2ï¼‰

### æ ¸å¿ƒèƒ½åŠ›

| ç±»åˆ«    | åŠŸèƒ½é¡¹                 | è¯´æ˜                                                                                                                  |
| ----- | ------------------- | ------------------------------------------------------------------------------------------------------------------- |
| è¿æ¥ç®¡ç†  | ğŸ”— **å•æœº&é›†ç¾¤** åŒæ¨¡å¼    | *å•æœºæ¨¡å¼*ï¼šè¿›ç¨‹å†… `Hub` ç®¡ç†æ‰€æœ‰è¿æ¥ï¼›*é›†ç¾¤æ¨¡å¼*ï¼šå¤šå®ä¾‹é€šè¿‡ **etcd Watch/Put** åŒæ­¥å¹¿æ’­æˆ–ç‚¹å¯¹ç‚¹æ¶ˆæ¯ï¼Œä¿è¯æ°´å¹³æ‰©å±•ï¼ˆé¦–ç‰ˆå®ç° `EtcdBus`ï¼ŒæŠ½è±¡ `MessageBus` æ¥å£ä¾¿äºåç»­æ›¿æ¢ï¼‰ã€‚ |
| æ¶ˆæ¯æ¨¡å‹  | ğŸš€ å¹¿æ’­ / ç‚¹å¯¹ç‚¹ / è‡ªå®šä¹‰è·¯ç”± | ç»Ÿä¸€ `Message` ç»“æ„ï¼ˆ`message_id` + `data`ï¼‰ï¼Œç”± **Dispatcher** è§£æè·¯ç”±ã€‚                                                       |
| å¿ƒè·³ä¿æ´»  | â¤ï¸ æœåŠ¡å™¨ & å®¢æˆ·ç«¯åŒå‘å¿ƒè·³    | WebSocket Ping/Pong + åº”ç”¨å±‚ `MsgPing`ã€‚è¶…æ—¶è‡ªåŠ¨æ–­é“¾ã€‚                                                                         |
| é”™è¯¯æ¢å¤  | ğŸ›¡ï¸ è¿æ¥å¼‚å¸¸è‡ªåŠ¨æ¸…ç†        | `shutdown()` ç¡®ä¿å…³é—­ã€æ—¥å¿—ã€èµ„æºå›æ”¶ã€‚                                                                                          |
| çƒ­æ’æ‹”é…ç½® | âš™ï¸ YAML/ENV         | è¯»å†™è¶…æ—¶ã€ç¼“å†²åŒºã€å¿ƒè·³é—´éš”ã€æ˜¯å¦å¯ç”¨é›†ç¾¤ç­‰å‡å¯çƒ­åŠ è½½ã€‚                                                                                         |
| è¿ç»´å¯è§‚æµ‹ | ğŸ“ˆ Prometheus æŒ‡æ ‡    | è¿æ¥æ•°ã€QPSã€å»¶è¿Ÿã€GCã€goroutine ç­‰å…³é”®æŒ‡æ ‡ï¼Œé™„ Grafana ç¤ºä¾‹ä»ªè¡¨ç›˜ã€‚                                                                      |

> **äº¤ä»˜é‡Œç¨‹ç¢‘**
>
> 1. **M1â€‘Alpha (5/31)**ï¼šå•æœºç‰ˆåŠŸèƒ½å®Œå¤‡ï¼Œå•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥â€¯80%ã€‚
> 2. **M2â€‘Beta (6/15)**ï¼šé›†ç¾¤æ¨¡å¼ **etcd é€‚é…å®Œæˆ**ï¼›ç«¯åˆ°ç«¯å‹æµ‹è¾¾åˆ° 10â€¯k conns / å®ä¾‹ï¼Œå¹¿æ’­ 5â€¯k msg/s æ— ä¸¢å¤±ã€‚
> 3. **M3â€‘RC (6/30)**ï¼šæ¥å£å†»ç»“ã€æ–‡æ¡£å®Œå–„ã€å‘å¸ƒ v1.0.0ã€‚

### æŠ€æœ¯æ ˆä¸æ¶æ„

```mermaid
flowchart LR
    subgraph Client
        A(Web / Mobile / IoT)
    end
    A -- ws:// --> B{Load Balancer\nNginx / LVS}
    subgraph Pod[ gHâ€‘Pod Ã—N ]
        direction LR
        C(Hub Core)
        D(Dispatcher)
        C <-- gRPC / etcd --> C
    end
    B --> C
    subgraph Infra
        E[(etcd Cluster)]
        F[(Prometheus)]
    end
    C -- Watch/Put --> E
    C -- Metrics --> F
```

* **WS æ¡†æ¶**ï¼šGorilla WebSocketï¼›æŠ½è±¡ `WSConn` æ¥å£ï¼Œå…¼å®¹ nhooyr/websocketã€‚
* **é›†ç¾¤æ¶ˆæ¯æ€»çº¿**ï¼šæ¥å£ `MessageBus`ï¼Œé¦–ç‰ˆå®ç° \`\`ï¼ˆKey è®¾è®¡ï¼š`/gohub/broadcast`ã€`/gohub/unicast/{clientID}`ï¼Œäº‹ä»¶é€šè¿‡ `Watch` åˆ†å‘ï¼‰ã€‚
* **é…ç½®**ï¼š`viper` è¯»å– `config.yaml` + ENVã€‚
* **æ—¥å¿—**ï¼š`log/slog` JSON è¾“å‡ºï¼Œæ”¯æŒåŠ¨æ€çº§åˆ«ã€‚
* **ç›‘æ§**ï¼š`promhttp` å¯¼å‡ºæŒ‡æ ‡ã€‚

### ç›®å½•ç»“æ„

```text
cmd/gohub/           # main, CLI
internal/
  hub/               # Hub & Client
  bus/               # MessageBus æ¥å£ + EtcdBus å®ç°
  websocket/         # WS é€‚é… & åç¨‹
  dispatcher/        # æ¶ˆæ¯è·¯ç”±
  handlers/          # ä¸šåŠ¡å¤„ç†å™¨(ç¤ºä¾‹ ping/chat)
configs/             # é»˜è®¤ config.yaml
frontend/            # React demo (äºŒæœŸ)
scripts/             # å‹æµ‹ & è¿ç»´è„šæœ¬
```

### æµ‹è¯•ä¸è´¨é‡ä¿éšœ

* **æµ‹è¯•é‡‘å­—å¡”**ï¼š

    * å•å…ƒæµ‹è¯• (`go test`) è¦†ç›–æ ¸å¿ƒç®—æ³•å’Œé”™è¯¯åˆ†æ”¯ã€‚
    * é›†æˆæµ‹è¯•ï¼šå¯åŠ¨ N å®ä¾‹ + **åµŒå…¥å¼ etcd**ï¼Œä½¿ç”¨ `websocket.Dialer` å¹¶å‘ 1â€¯k å®¢æˆ·ç«¯éªŒè¯å¹¿æ’­ä¸€è‡´æ€§ã€‚
    * æ€§èƒ½åŸºå‡†ï¼š`go test -bench`ï¼›`k6`/è‡ªç ”è„šæœ¬æŒç»­å‹æµ‹ã€‚
* **CI/CD**ï¼šGitHub Actions â†’ lint + test + build + Docker multiâ€‘arch imageã€‚
* **è¦†ç›–ç‡é—¨ç¦**ï¼šPR å¿…é¡» â‰¥â€¯80%ï¼Œå…³é”®ç›®å½• â‰¥â€¯90%ã€‚

### å®‰å…¨ & æ€§èƒ½

* **TLS/WSS** æ”¯æŒï¼Œç¤ºä¾‹ Nginx é…ç½®ã€‚
* **Origin æ ¡éªŒ & Token é‰´æƒ** é’©å­ã€‚
* **Backpressure**ï¼šå‘é€é˜Ÿåˆ—æ»¡ â†’ å®¢æˆ·ç«¯å¯é€‰ä¸¢åŒ…æˆ–è¸¢ä¸‹çº¿ã€‚
* **æ‰¹é‡å†™ä¼˜åŒ–**ï¼š`SetWriteDeadline` + èšåˆå°æ¶ˆæ¯ã€‚

---

## äºŒæœŸç›®æ ‡ï¼ˆ2025â€‘Q3ï¼‰

| åŠŸèƒ½         | è¯´æ˜                                    |
| ---------- | ------------------------------------- |
| React å‰ç«¯ç¤ºä¾‹ | èŠå¤©å®¤ UIï¼Œè‡ªåŠ¨é‡è¿ï¼Œå¿ƒè·³æç¤ºï¼ŒTypeScript + Viteã€‚   |
| åˆ†ç»„/ä¸»é¢˜è®¢é˜…    | Hub æ”¯æŒ `room` æ¦‚å¿µï¼Œå®¢æˆ·ç«¯å¯ join/leaveã€‚     |
| SDK & ç¤ºä¾‹   | JS/TS SDKï¼ŒAndroid Kotlin ç¤ºä¾‹ï¼ŒåµŒå…¥å¼ C ç¤ºä¾‹ã€‚ |
| è¿ç»´ UI      | ç®€æ˜“æ§åˆ¶å°ï¼šå®æ—¶è¿æ¥æ•°ã€æˆ¿é—´åˆ—è¡¨ã€è¸¢äººã€é™æµã€‚               |

---

## é•¿æœŸæ¼”è¿›æ–¹å‘

* **æ¶ˆæ¯æŒä¹…åŒ–**ï¼šå¯æ’æ‹”å­˜å‚¨å±‚ï¼ˆPostgreSQLã€MongoDBã€Kafka Topic ç­‰ï¼‰ã€‚
* **ç«¯åˆ°ç«¯åŠ å¯†**ï¼šæ”¯æŒå®¢æˆ·ç«¯æœ¬åœ°åŠ è§£å¯†ã€‚
* **WebTransport / HTTP3**ï¼šè·Ÿè¿›ä¸‹ä¸€ä»£å®æ—¶åè®®ã€‚

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT License** ï¼Œå…è®¸è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€å†åˆ†å‘ï¼Œä½†éœ€ä¿ç•™åŸä½œè€…ç‰ˆæƒå£°æ˜ã€‚

> æ¬¢è¿ Star ğŸ‰ï¼ŒIssue & PRâ¤ï¸ ï¼
